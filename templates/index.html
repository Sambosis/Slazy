<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Agent Display</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js" crossorigin="anonymous"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    .panel { border: 1px solid #ccc; padding: 10px; margin: 10px; }
    .user { background-color: #d0f0d0; }
    .assistant { 
      background-color: #d0d0f0;
      font-size: 1.3em;  /* Make assistant messages 20% larger */
    }
    #inputForm { margin: 20px; }
  </style>
</head>
<body>
    <!-- Input form for user responses -->
  <div id="inputForm">
    <input type="text" id="userInput" placeholder="Type your response here">
    <button id="sendInput">Send</button>
  </div>
  <div class="panel assistant" id="assistant_panel">
    <h2>Assistant Messages</h2>
    <div id="assistant_messages"></div>
  </div>
  <div class="panel tool" id="tool_panel">
    <h2>Tool Results</h2>
    <div id="tool_messages"></div>
  </div>
  <div class="panel user" id="user_panel">
    <h2>User Messages</h2>
    <div id="user_messages"></div>
  </div>

  <script>
  // Force polling transport to avoid websocket handshake issues.
  var socket = io({ transports: ['polling'] });

  socket.on('connect', function() {
    console.log("Connected to server");
  });

  // Listen for updates
  socket.on('update', function(data) {
    // Update User Messages
    var userDiv = document.getElementById('user_messages');
    userDiv.innerHTML = '';
    data.user.forEach(function(message) {
      var msgElement = document.createElement('div');
      msgElement.innerHTML = message;
      userDiv.appendChild(msgElement);
    });

    // Update Assistant Messages
    var assistantDiv = document.getElementById('assistant_messages');
    assistantDiv.innerHTML = '';
    data.assistant.forEach(function(message) {
      var msgElement = document.createElement('div');
      msgElement.innerHTML = message;
      assistantDiv.appendChild(msgElement);
    });

    // Update Tool Results
    var toolDiv = document.getElementById('tool_messages');
    toolDiv.innerHTML = '';
    data.tool.forEach(function(message) {
      if (typeof message === 'object' && message.code && message.css) {
        if (!document.getElementById('pygments-style')) {
          var styleElement = document.createElement('style');
          styleElement.id = 'pygments-style';
          styleElement.innerHTML = message.css;
          document.head.appendChild(styleElement);
        }
        var codeElement = document.createElement('div');
        codeElement.innerHTML = message.code;
        toolDiv.appendChild(codeElement);
      } else {
        var msgElement = document.createElement('div');
        msgElement.innerHTML = message;
        toolDiv.appendChild(msgElement);
      }
    });
    });
    document.getElementById('sendInput').addEventListener('click', function() {
      var input = document.getElementById('userInput').value;
      if (input) {
        socket.emit('user_input', { input: input });
        document.getElementById('userInput').value = '';
      }
  });
</script>
</body>
</html>
