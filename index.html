<!-- index.html (Modified) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Agent Display</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js" crossorigin="anonymous"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    .panel { border: 1px solid #ccc; padding: 10px; margin: 10px; }
    .user { background-color: #d0f0d0; }
    .assistant { background-color: #d0d0f0; }
    /* No longer need hardcoded Pygments CSS here */
  </style>
</head>
<body>
  <div class="panel assistant" id="assistant_panel">
    <h2>Assistant Messages</h2>
    <div id="assistant_messages"></div>
  </div>
  <div class="panel tool" id="tool_panel">
    <h2>Tool Results</h2>
    <div id="tool_messages"></div>
  </div>
  <div class="panel user" id="user_panel">
    <h2>User Messages</h2>
    <div id="user_messages"></div>
  </div>

  <script>
    var socket = io();
    socket.on('connect', function() {
      console.log("Connected to server");
    });

    // Listen for updates
    socket.on('update', function(data) {
      // User messages
      var userDiv = document.getElementById('user_messages');
      userDiv.innerHTML = ''; // Clear previous content
      data.user.forEach(function(message) {
        var msgElement = document.createElement('div');
        msgElement.innerHTML = message;
        userDiv.appendChild(msgElement);
      });

      // Assistant messages
      var assistantDiv = document.getElementById('assistant_messages');
      assistantDiv.innerHTML = ''; // Clear previous content
      data.assistant.forEach(function(message) {
        var msgElement = document.createElement('div');
        msgElement.innerHTML = message;
        assistantDiv.appendChild(msgElement);
      });

      // Tool messages - now handling CSS dynamically
      var toolDiv = document.getElementById('tool_messages');
      toolDiv.innerHTML = ''; // Clear previous content
      data.tool.forEach(function(message) {
        // Check if message is an object with code and css
        if (typeof message === 'object' && message.code && message.css) {
          // 1. Add CSS (only if style tag doesn't exist)
          if (!document.getElementById('pygments-style')) {
            var styleElement = document.createElement('style');
            styleElement.id = 'pygments-style';
            styleElement.innerHTML = message.css;
            document.head.appendChild(styleElement);
          }

          // 2. Add code
          var codeElement = document.createElement('div');
          codeElement.innerHTML = message.code;
          toolDiv.appendChild(codeElement);
        } else {
          // Handle regular messages (not code)
          var msgElement = document.createElement('div');
          msgElement.innerHTML = message;
          toolDiv.appendChild(msgElement);
        }
      });
    });
  </script>
</body>
</html>